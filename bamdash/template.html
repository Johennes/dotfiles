<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="refresh" content="600" >
        <title>bam!dash</title>
        <link rel="stylesheet" href="https://necolas.github.io/normalize.css/latest/normalize.css">
    </head>
    <style>
        body {
            font-family: sans-serif;
            padding-left: 20px;
            padding-right: 20px;
        }
        .group-container {
            /* float: left; */
            /* margin-bottom: 10px; */
        }
        .group-container:nth-child(n+2) {
            /* margin-left: 20px; */
        }
        .agent-container {
            /* clear: both; */
            margin-bottom: 30px;
        }
        dd {
            margin-left: 0;
            margin-bottom: 25px;
            margin-top: 0;
        }
        .good {
            color: #26a664;
        }
        .bad {
            color: #e44e57;
        }
        .small {
            font-size: 90%;
        }
        .timestamp {
            clear: both;
            color: #a0afba;
        }
        a, a:visited {
            color: #0b7b99;
        }
        p {
            margin: 5px 0;
        }
        #release-status {
            /* column-count: 3; */
            display: grid;
grid-template-columns: 1fr 1fr 1fr 1fr;
grid-auto-rows: auto;
grid-gap: 10px;
justify-items: center;
        }
        #release-status .group-container {
            /* display: inline-block; */
            /* width: 100%; */
        }
    </style>
    <body>
        {{#groups}}
        <div class="group-container">
            <h2>{{name}}</h2>
            <dl>
                {{#failures}}
                <dt class="bad">{{planName}}</dt>
                <dd class="small">
                    ðŸ’¥ {{buildTime}}<br/>
                    <a href="{{resultLink}}" target="_blank">Open result</a><br/>
                    <a href="{{planLink}}" target="_blank">Open plan</a>
                </dd>
                {{else}}
                <span class="good small">
                    âœ… Green as grass
                </span>
                {{/failures}}
            </dl>
        </div>
        {{/groups}}
        <div id="release-status">
            {{#releaseStatus}}
            <div class="group-container">
                <h2>{{brand}}</h2>
                {{#if readyToSubmit}}
                    <p class="good">Ready to submit</p>
                {{else}}
                    {{#unless translations.successful}}
                    <p class="bad">Waiting for translations</p>
                    {{/unless}}
                    {{#unless testFlight.successful}}
                    <p class="bad">TestFlight build failed</p>
                    {{/unless}}
                    {{#if processing}}
                    <p class="bad">Build processing in AppStoreConnect</p>
                    {{/if}}
                {{/if}}
                <h3>Details</h3>
                <dt><a href="{{translations.resultLink}}" target="_blank">Translations</a></dt>
                <dd class="small">
                    <p>
                        Bamboo plan ran {{translations.buildTime}}
                    </p>
                    <p>
                        Status: {{#if translations.successful}}
                            <span class="good">translations done</span>
                        {{else}}
                            <span class="bad">translations incomplete</span>
                        {{/if}}
                    </p>
                </dd>
                <dt><a href="{{testFlight.resultLink}}" target="_blank">TestFlight build {{releaseBranch}}</a></dt>
                <dd class="small">
                    <p>
                        Bamboo plan ran {{testFlight.buildTime}}
                    </p>
                    {{#if testFlight.commit}}
                    <p>
                        {{testFlight.commit.committer}} committed {{testFlight.commit.commitTime}}<br/>
                        <a href="{{testFlight.commit.link}}">{{testFlight.commit.sha}}</a> â€“ {{testFlight.commit.subject}}
                    </p>
                    {{/if}}
                    <p>
                        Status: {{#if testFlight.successful}}
                            <span class="good">successful</span> â€“ {{testFlight.bundleVersion}}
                        {{else}}
                            <span class="bad">failed</span>
                        {{/if}}
                    </p>
                </dd>
                <dt><a href="{{latestBuild.resultLink}}" target="_blank">AppStoreConnect status</a></dt>
                <dd class="small">
                    <p>
                        Bamboo plan ran {{latestBuild.buildTime}}
                    </p>
                    <p>
                        Status: {{#if latestBuild.successful}}
                            <span class="good">successful</span>
                        {{else}}
                            <span class="bad">failed</span>
                        {{/if}}
                    </p>
                    <p>
                        Latest available build: {{latestBuild.shortVersion}} ({{latestBuild.bundleVersion}})
                    </p>
                </dd>
            </div>
            {{/releaseStatus}}
        </div>
        <div class="agent-container">
            <h2>Agents</h2>
            {{agents.numTotal}} total / {{agents.numBusy}} busy<br/>
            {{#agents.inactiveOrDisabled}}
            <dl>
                <dt class="bad">{{name}}</dt>
                <dd class="small">
                    {{#unless isActive}}
                    ðŸ’¥ inactive<br/>
                    {{/unless}}
                    {{#unless isEnabled}}
                    ðŸ’¥ disabled<br/>
                    {{/unless}}
                    <a href="{{link}}" target="_blank">Open agent</a>
                </dd>
            </dl>
            {{/agents.inactiveOrDisabled}}
        </div>
        <div class="timestamp small">
            Last update: {{date}}
        </div>
    </body>
</html>
